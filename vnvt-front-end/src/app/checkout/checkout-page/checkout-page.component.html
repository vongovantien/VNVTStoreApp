<div class="checkout">
  <h4 class="checkout__title">Checkout</h4>
  <div class="checkout__container">
    <!-- Left Side: Dynamic Tabs -->
    <div class="checkout__form">
      <mat-horizontal-stepper linear #stepper labelPosition="bottom">
        <mat-step [stepControl]="addressForm" label="Address">
          <form [formGroup]="addressForm">
            <h6 class="checkout__subtitle">Shipping Information</h6>
            <div class="checkout__form-group">
              <mat-form-field class="checkout__form-field checkout__form-field--half">
                <mat-label>First Name</mat-label>
                <input matInput formControlName="firstName" placeholder="First Name">
                <mat-error *ngIf="addressForm.get('firstName')?.hasError('required')">
                  First Name is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field class="checkout__form-field checkout__form-field--half">
                <mat-label>Last Name</mat-label>
                <input matInput formControlName="lastName" placeholder="Last Name">
                <mat-error *ngIf="addressForm.get('lastName')?.hasError('required')">
                  Last Name is required.
                </mat-error>
              </mat-form-field>
            </div>

            <mat-form-field class="checkout__form-field">
              <mat-label>Address</mat-label>
              <input matInput formControlName="address" placeholder="Address">
              <mat-error *ngIf="addressForm.get('address')?.hasError('required')">
                Address is required.
              </mat-error>
            </mat-form-field>

            <mat-form-field class="checkout__form-field">
              <mat-label>Apartment, suite, etc (optional)</mat-label>
              <input matInput formControlName="apartment" placeholder="Apartment, suite, etc">
            </mat-form-field>

            <div class="checkout__form-group">
              <mat-form-field class="checkout__form-field checkout__form-field--third">
                <mat-label>City</mat-label>
                <input matInput formControlName="city" placeholder="City">
                <mat-error *ngIf="addressForm.get('city')?.hasError('required')">
                  City is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field class="checkout__form-field checkout__form-field--third">
                <mat-label>Country</mat-label>
                <input matInput formControlName="country" placeholder="Country">
                <mat-error *ngIf="addressForm.get('country')?.hasError('required')">
                  Country is required.
                </mat-error>
              </mat-form-field>

              <mat-form-field class="checkout__form-field checkout__form-field--third">
                <mat-label>Zipcode</mat-label>
                <input matInput formControlName="zipcode" placeholder="Zipcode">
                <mat-error *ngIf="addressForm.get('zipcode')?.hasError('required')">
                  Zipcode is required.
                </mat-error>
              </mat-form-field>
            </div>

            <button mat-raised-button color="primary" (click)="onContinue(stepper)"
              class="checkout__button">Continue</button>
          </form>
        </mat-step>

        <mat-step label="Shipping">
          <!-- Shipping form content here -->
          <button mat-raised-button color="primary" (click)="onContinue(stepper)"
            class="checkout__button">Continue</button>
        </mat-step>

        <mat-step label="Payment">
          <!-- Payment form content here -->
          <button mat-raised-button color="primary" (click)="onContinue(stepper)"
            class="checkout__button">Submit</button>
        </mat-step>
      </mat-horizontal-stepper>
    </div>

    <!-- Right Side: Fixed Cart Summary -->
    <div class="checkout__summary">
      <h6 class="checkout__summary-title">Your cart</h6>

      <div *ngFor="let item of cartItems$ | async" class="checkout__cart-item">
        <img class="checkout__cart-item-image" [src]="item.productImages[0].imageUrl" alt="Product Image">
        <div class="checkout__cart-item-details">
          <div class="checkout__cart-item-name">{{ item.name }}</div>
          <div class="checkout__cart-item-quantity">Quantity: {{ item.quantity }}</div>
          <div class="checkout__cart-item-price">${{ item.price }}</div>
        </div>
        <button mat-raised-button class="checkout__cart-item-remove" (click)="removeItem(item)">Remove</button>
      </div>

      <div class="checkout__summary-details">
        <div class="checkout__summary-line">
          <span>Subtotal</span>
          <!-- <span>${{ subtotal }}</span> -->
        </div>
        <div class="checkout__summary-line">
          <span>Shipping</span>
          <!-- <span>{{ shipping === 0 ? 'Calculated at the next step' : '$' + shipping }}</span> -->
        </div>
        <div class="checkout__summary-line checkout__summary-line--total">
          <span>Total</span>
          <span>{{ (getDiscountedTotal() | async) | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>
  </div>
</div>
